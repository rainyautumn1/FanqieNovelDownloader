# 番茄小说内容下载器 (Fanqie Novel Downloader)

## 简介
这是一个基于 Python (PySide6) 开发的高级番茄小说内容下载工具。它集成了内置浏览器，支持用户直接浏览番茄小说网，登录 SVIP 账号以获取完整内容，并提供灵活的单本与批量下载功能。

**⚠️ 重要免责声明**
1. **仅供学习研究**: 本工具仅供个人学习 Python 网络爬虫技术、GUI 开发及研究使用。
2. **版权声明**: 请尊重小说作者及平台的版权。**严禁**使用本工具进行任何形式的商业盈利、非法传播或侵犯知识产权的行为。
3. **责任自负**: 使用本工具产生的任何法律后果由使用者自行承担。

---

## 核心功能

### 1. 📖 内置浏览器与账号互通
- **内置 Chromium 内核浏览器**: 直接在软件内浏览番茄小说官网，无需手动复制粘贴 URL。
- **SVIP 登录支持**: 支持在内置浏览器中登录您的 SVIP 账号。软件会自动同步 Cookie，从而**解锁并下载 SVIP 专属加密章节**。
- **持久化登录**: 新增浏览器数据持久化存储功能，软件重启后**自动保持登录状态**，无需重复扫码。

### 2. ⚡ 智能单本下载
当您浏览至某本书的**目录页**时，软件会自动检测并激活下载按钮：
- **自定义章节选择**:
  - 下载全本。
  - 仅下载前 N 章。
  - 自定义章节范围 (如: 10-50)。
- **文件输出选项**:
  - **合并模式**: 所有章节保存为一个 TXT/EPUB 文件。
  - **拆分模式**: 每一章保存为一个单独的 TXT/MD 文件，并自动归档至书名文件夹。
- **格式支持**: TXT (纯文本), EPUB (电子书), MD (Markdown)。

### 3. 📦 榜单批量下载
当您浏览至**排行榜**或**分类书库**页面（如“男频-新书榜-科幻末世”）时，软件会激活批量下载功能：
- **一键批量**: 支持下载当前榜单页面的前 N 本热门书籍。
- **试读控制**: 可设置每本书仅下载前 X 章（例如仅下载前 10 章预览）。
- **文件管理**:
  - **分章保存**: 新增批量分章下载选项。勾选后，每本书会自动创建一个以书名命名的独立文件夹，章节文件单独存放。
  - **智能归档**: 自动根据榜单层级创建存储目录，分类清晰。
  - 示例路径: `downloads\男频\新书榜\科幻末世\书名\001_第一章.txt` (开启分章模式)

### 4. 🛡️ 核心技术特性
- **字符反混淆 (Anti-Obfuscation)**: 内置特定算法，自动还原被网站混淆的字体字符。
- **多线程处理**: 界面操作与下载任务分离，下载过程中界面不卡顿。
- **实时反馈**: 底部状态栏和日志窗口实时显示当前的下载进度、速度及错误信息。

---

## 技术栈
- **语言**: Python 3.8
- **GUI 框架**: PySide6 (Qt WebEngine)
- **网络请求**: Requests
- **HTML 解析**: BeautifulSoup4, lxml
- **电子书生成**: EbookLib

---

## 使用指南

### 1. 环境准备
确保已安装 Python 3.8+ 版本。
安装项目依赖：
```bash
pip install -r requirements.txt
```

### 2. 启动程序
直接运行启动脚本或 Python 主程序：
```bash
# Windows 用户推荐直接运行
run.bat

# 或手动运行
python main.py
```

### 3. 操作流程

#### A. 下载单本小说
1. 在软件内置浏览器中，点击想看的书，进入**书籍目录页**（网址通常包含 `/page/`）。
2. 右下角 **"下载此书"** 按钮变亮。
3. 点击按钮，在弹出的对话框中选择：
  - 下载范围（全部/自定义）。
  - 是否拆分章节文件。
  - 目标格式 (TXT/EPUB/MD)。
4. 确认后开始下载。

#### B. 批量下载榜单
1. 在内置浏览器中点击 **"排行榜"** 或 **"书库"**。
2. 选择具体的分类（例如：男频 -> 新书榜 -> 玄幻）。
3. 右下角 **"批量下载"** 按钮变亮。
4. 点击按钮，设置：
  - **Top N**: 下载榜单前多少本书。
  - **章节限制**: 每本书下载多少章 (0 为全本)。
  - **分章保存**: 勾选后，将为每本书创建独立文件夹并保存分章文件。
5. 点击开始，程序将自动按 `频道\榜单\分类` 的结构保存文件。

---

## 常见问题
- **下载内容不全？**
  - 请尝试在内置浏览器中登录您的番茄小说账号（特别是 SVIP 账号），软件会自动获取权限。
- **登录状态丢失？**
  - 最新版本已修复此问题。软件会自动在 `browser_data` 目录存储登录凭证，请勿随意删除该文件夹。
- **浏览器无法跳转新标签页？**
  - 已做特殊处理，所有链接均会在当前窗口打开，方便操作。
- **批量下载的文件夹名称？**
  - 系统会自动去除 "官网"、"·" 等冗余字符，只保留核心分类名。
- **没有PYTHON环境？**
  - 查询百度或者bilibili有各种安装教程
- **有没有不用安装Python环境的运行办法？**
  - 你猜build.bat是用来干嘛的，但是这个也需要在有python环境的电脑中运行，运行后会生成disk文件夹，将文件夹里面的所有内容压缩打包分发给其他用户，其他用户解压后就可在没有Python环境的情况下直接运行.exe文件
- **为什么我不直接打包.exe文件？**
  - PySide6的库包太大了
  
